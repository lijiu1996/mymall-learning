# 系统设计场景

### 消息push vs pull场景

场景出现原因 社交媒体人与人之间的连接场景

push场景特点
* 实时性
* 有状态(对于每个接收者 都需要对消息进行存储 如果消息很多会消耗大量磁盘IO)
* 写扩散问题 -- 如果发布者比如大v 他的发布对象很多
此时需要同时写上亿个队列 磁盘io很高

写扩散问题解决
* 限制用户数 -- 微信
* 分步进行数据写入 比如将同时写入转换成一分钟内分批次陆续写入 kafka
* 优化存储策略 采用nosql or 大数据方案

pull场景特点
* 存在延迟
* 无状态(仅发布者需要存储一份)
* 如果粉丝同时拉取大v发布的消息,会造成超高的qps

读扩散问题解决
* 限流 
* 延迟查询 把同时的查询改成批量
* 增加缓存

最终解决方案 根据发布对象的量决定是推送还是拉去
          twitter就是这么做的 数量多了进行pull 数量少进行push