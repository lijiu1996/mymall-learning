# 系统设计场景

### 消息push vs pull场景

push场景特点
* 实时性
* 有状态(对于每个接收者 都需要对消息进行存储)
* 写扩散问题 -- 如果发布者比如大v 他的发布对象很多
此时需要同时写上亿个队列 磁盘io很高

pull场景特点
* 存在延迟
* 无状态(仅发布者需要存储一份)
* 如果粉丝同时拉取大v发布的消息,会造成超高的qps

写扩散问题解决
* 限制用户数 -- 微信
* 分步进行数据写入 比如将同时写入转换成一分钟内分批次陆续写入
* 优化存储策略 采用nosql or 大数据方案

读扩散问题解决
* 限流
* 增加缓存

### 应用如何实现无状态

首先明确什么是状态数据

### 应用如何实现接口幂等性

实现一 数据库唯一性约束
实现二 额外的状态字段进行数据库逻辑判断

前台请求携带唯一id 存入redis
网关服务根据redis中是否存在唯一id判断返回结果

### mysql 集群

分片算法 id范围分片/ 哈希分片
        负载不均匀/负载均匀 rehash困难

### 分布式锁

适用场景
数据必须保证一致性 比如金融业务
并发量低但是重要的业务系统 比如 分布式结算

对于并发量高但是数据价值比较低对于一致性要求没有那么高的场景 适合用最终一致性
